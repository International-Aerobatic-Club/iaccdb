# manage list of results
# translates category result file CategoryResult to database flight identifiers
# generated by ACRO_results_list and manually edited with flight identifiers
module ACRO
class ResultsList
  LIST_NAME = 'results_list.yml'

  class ResultsFile
    attr_accessor :file_name
    attr_accessor :category
    attr_accessor :description
    attr_accessor :flights

    def initialize(file_name)
      @file_name = File.basename(file_name)
      category_result = YAML.load_file(file_name)
      @category = category_result.category_name
      @description = category_result.description
      @flights = []
      category_result.flight_names.each do |flight_name|
        @flights << ResultsFlight.new(flight_name)
      end
    end
  end

  class ResultsFlight
    attr_accessor :flight_name
    attr_accessor :flight_id

    def initialize(flight_name)
      @flight_name = flight_name
      @flight_id = 'missing_id'
    end
  end

  def initialize(control_file)
    @contest_info = ControlFile.new(control_file)
    @list = []
  end

  def populate_with_results_files
    @contest_info.category_result_files.each do |f|
      @list << ResultsFile::new(f)
    end
  end

  def file_name
    File.join(@contest_info.data_directory, LIST_NAME)
  end

  def write_to_file
    File.open(file_name, 'w') do |f|
      f << @list.to_yaml
    end
  end

  def read_from_file
    @list = YAML.load_file(file_name)
  end

end
end
